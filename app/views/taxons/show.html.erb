<%= display_header title: page.title, breadcrumbs: [:taxons, page.taxon] do %>
  <% unless page.unpublished? %>
    <%= render 'show_header', taxon_content_id: page.taxon_content_id %>
  <% end %>
<% end %>

<% if user_can_administer_taxonomy? %>
  <div class='view-on-site'>
    <% if page.published? %>
      View on site: <%= link_to page.base_path, website_url(page.base_path) %>
    <% elsif page.draft? %>
      <%= link_to "View draft page", website_url(page.base_path, draft: true) %>
    <% end %>
  </div>

  <div class="well state-box">
    <div class="state">
      State: <%= page.publication_state_name %>
      <% if page.redirected? %>
        (redirects to <%= page.redirect_to %>)
      <% end %>
    </div>
    <% if page.published? %>
      <%= link_to "Delete", taxon_confirm_delete_path(page.taxon_content_id), class: 'delete-link' %>
    <% elsif page.draft? %>
      <%= link_to taxon_confirm_publish_path(page.taxon_content_id), class: 'btn btn-md btn-default' do %>
        Publish
      <% end %>
      <%= link_to taxon_confirm_bulk_publish_path(page.taxon_content_id), class: 'btn btn-md btn-default' do %>
          Publish Tree
      <% end %>
      <%= link_to "Delete", taxon_confirm_discard_path(page.taxon_content_id), class: 'delete-link' %>
    <% elsif page.unpublished? %>
      <%= link_to taxon_confirm_restore_path(page.taxon_content_id), class: 'btn btn-md btn-default' do %>
        Restore
      <% end %>
    <% end %>
  </div>
<% end %>

<% unless page.unpublished? %>
  <% if page.associated_taxons.present? %>
    <h3><%= t('views.taxons.associated_taxons') %></h3>
    <div class="associated-taxons">
      <ul>
        <% page.associated_taxons.each do |t| %>
          <li>
            <%= link_to t["title"], taxon_path(t["content_id"]) %>
          </li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="btn-group pull-right taxonomy-visualisation-buttons"
       role="group"
       aria-label="Taxonomy visualisations">
    <% TaxonsController::VISUALISATIONS.each do |viz| %>
      <a href="<%= taxon_path(params[:id], viz: viz) %>"
         class="btn btn-lg <%= viz == page.visualisation ? 'btn-primary' : 'btn-default' %>"
         role="button">
        <%= viz.titlecase %>
      </a>
    <% end %>
  </div>

  <% if page.visualisation.in? TaxonsController::VISUALISATIONS %>
    <%= render partial: page.visualisation, locals: { page: page } %>
  <% else %>
    <h2>Unknown visualisation <%= page.visualisation %>
  <% end %>
<% end %>
